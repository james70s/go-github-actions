# 发布版本
name: Release
on:
  create:
    tags:
    - v*

jobs:
  docker:
    name: Release on GitHub
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v1

    # - name: Info
    #   run: echo docker.pkg.github.com/${{ github.repository }}:${IMAGE_TAG}

    # # https://goreleaser.com/
    # - name: Validates GO releaser config
    #   uses: docker://goreleaser/goreleaser:latest
    #   with:
    #     args: check

    # - name: Create release on GitHub
    #   uses: docker://goreleaser/goreleaser:latest
    #   with:
    #     args: release
    #   env:
    #     GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}

    - name: Build docker & push
      uses: mr-smithers-excellent/docker-build-push@v2
      with:
        image: ${{ github.repository }}
        # tag: latest
        registry: registry.limei.net.cn
        dockerfile: Dockerfile
        username: ${{ secrets.REGISTRY_USERNAME }}
        password: ${{ secrets.REGISTRY_PASSWORD }}
  

  
  deploy:
    name: Deploy to Host
    runs-on: ubuntu-latest
    # needs: [docker]
    steps:
    - name: executing remote ssh commands using password
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SUN_HOST }}
        key: ${{ secrets.SUN_DEPLOY_KEY }}
        # username: ${{ secrets.SUN_HOST_USERNAME }}
        # password: ${{ secrets.SUN_HOST_PASSWORD }}
        port: ${{ secrets.SUN_HOST_PORT }}
        # script: whoami
        script: |
          mkdir abc
          ls -al


